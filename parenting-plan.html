<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parenting Plan - The Co-Parenting Compass</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@700&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* ... original styles unchanged ... */
    </style>
</head>
<body>
    <div class="main-container">
        <div id="sidebar-placeholder" class="hidden lg:block flex-shrink-0 w-64 bg-gray-900/80 backdrop-blur-sm"></div>
        <div id="main-content-bg"></div>
        <main class="main-content flex-1">
            <div class="content-wrapper min-h-full p-6 sm:p-8">
                <div class="max-w-7xl mx-auto">
                    <!-- Landing Page View -->
                    <div id="landing-view" class="view-container active">
                        <!-- ... landing content unchanged ... -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                            <div id="start-wizard-btn" class="option-card bg-gray-800 p-8 rounded-xl text-center">
                                <i class="fas fa-magic text-5xl text-blue-400 mb-4"></i>
                                <h4 class="text-2xl font-bold text-white">Automated Wizard</h4>
                                <p class="text-gray-400">The recommended path. Answer a few questions to build a plan tailored to your needs.</p>
                            </div>
                            <div id="start-manual-btn" class="option-card bg-gray-800 p-8 rounded-xl text-center">
                                <i class="fas fa-file-lines text-5xl text-teal-400 mb-4"></i>
                                <h4 class="text-2xl font-bold text-white">Manual Builder</h4>
                                <p class="text-gray-400">Go straight to the full plan builder and select the sections you need.</p>
                            </div>
                            <div id="featured-forms-card" class="option-card bg-gray-800 p-8 rounded-xl text-center">
                                 <i class="fas fa-star text-5xl text-amber-400 mb-4"></i>
                                 <h4 class="text-2xl font-bold text-white">Featured Forms</h4>
                                 <p class="text-gray-400">Quickly access other useful templates like Affidavits or School Letters.</p>
                            </div>
                        </div>
                    </div>
                    <div id="wizard-view" class="view-container"></div>
                    <div id="builder-view" class="view-container">
                         <div id="builder-header" class="flex justify-between items-center mb-6">
                            <h2 class="text-3xl font-bold font-roboto-slab">Parenting Plan Builder</h2>
                            <div><button id="save-plan-btn" class="btn-secondary"><i class="fas fa-save mr-2"></i>Save Progress</button></div>
                        </div>
                        <div id="steps-container"></div>
                        <div id="navigation-container" class="flex justify-between items-center mt-8 pt-6 border-t border-gray-600"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <!-- Modals -->
    <div id="alert-modal" class="modal">
      <div class="modal-content text-center">
        <h3 id="alert-modal-title" class="text-2xl font-bold text-white mb-4"></h3>
        <p id="alert-modal-message" class="text-gray-300 mb-6"></p>
        <button id="alert-modal-close" class="btn-primary w-full">OK</button>
      </div>
    </div>
    <div id="disclaimer-modal" class="modal">
      <div class="modal-content">
        <h3 class="text-2xl font-bold text-white mb-4">Important Disclaimer</h3>
        <p class="text-gray-300 mb-6 text-sm">You are about to generate a document based on the information you have provided. Flamea provides tools to help you organize your information, but this is <b>not legal advice</b>. The user is solely responsible for the content and its application. For legal advice, please consult a qualified professional or visit our free resources on the LegalHelp page. By proceeding, you acknowledge that you have read and understood this disclaimer.</p>
        <label class="flex items-center space-x-3 mb-6 cursor-pointer">
            <input type="checkbox" id="disclaimer-agree" class="h-5 w-5 rounded bg-gray-600 border-gray-500 text-blue-600 focus:ring-blue-500">
            <span class="text-white">I Understand and Agree</span>
        </label>
        <div class="flex justify-end gap-4">
             <button id="disclaimer-cancel" class="btn-secondary">Cancel</button>
             <button id="disclaimer-proceed" class="btn-primary" disabled>Proceed</button>
        </div>
      </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- SECTION 0: All functions must be defined before they are referenced. ---

            // Placeholders for required functions (must be implemented for full functionality)
            function renderPartiesSection(container) { container.innerHTML = '<div>Parties Section</div>'; }
            function renderCustodySection(container) { container.innerHTML = '<div>Custody Section</div>'; }
            function renderExpensesSection(container) { container.innerHTML = '<div>Expenses Section</div>'; }
            function renderCommunicationSection(container) { container.innerHTML = '<div>Communication Section</div>'; }
            function renderSummarySection(container) { container.innerHTML = '<div>Summary Section</div>'; }
            function collectPartiesData() { return {}; }
            function collectCustodyData() { return {}; }
            function collectExpensesData() { return {}; }
            function collectCommunicationData() { return {}; }
            function generatePartiesDoc(data) { return ''; }
            function generateCustodyDoc(data) { return ''; }
            function generateExpensesDoc(data) { return ''; }
            function generateCommunicationDoc(data) { return ''; }
            function generateDocument(sectionIds) { return ''; }
            function generateOptions(arr, selected = '') { return arr.map(opt => `<option value="${opt}" ${opt === selected ? 'selected' : ''}>${opt}</option>`).join(''); }
            function getPartyNames() { const names = []; document.querySelectorAll('.party-name').forEach(input => { if (input.value.trim()) names.push(input.value.trim()); }); return names.length > 0 ? names : ['Parent A', 'Parent B']; }
            function addGuardian(side) {}
            function addAddress(container) {}
            function addContact(container) {}
            function addChild() {}
            function addExpenseCategory(name = '') {}
            function addExpenseItem(container) {}
            function addCommunicationMethod(container, parties) {}
            function updatePartyNames(e) {}
            function updateAllPartyDropdowns() {}
            function updatePartyDropdown(selectElement) {}
            function updateCommunicationPairs() {}
            function updateExpenseDashboard() {}
            function logEvent() {}
            function updateTimeDashboard() {}

            // --- CORE APP LOGIC, NAVIGATION, WIZARD ---
            function switchView(viewId) {
                Object.values(views).forEach(v => v.classList.remove('active'));
                if (views[viewId]) views[viewId].classList.add('active');
                state.currentView = viewId;
            }
            function showAlert(title, message, isHtml = false) {
                document.getElementById('alert-modal-title').textContent = title;
                const msgElem = document.getElementById('alert-modal-message');
                if (isHtml) msgElem.innerHTML = message;
                else msgElem.textContent = message;
                document.getElementById('alert-modal').style.display = 'flex';
            }
            function showDisclaimer(sections) {
                document.getElementById('disclaimer-modal').style.display = 'flex';
            }
            function renderBuilder(sectionIds) {
                containers.steps.innerHTML = '';
                // Render first section for demonstration
                if (sectionIds && sectionIds.length > 0) {
                    const section = state.allSections.find(s => s.id === sectionIds[0]);
                    if (section) section.render(containers.steps);
                }
            }
            function updateBuilderStep() {}
            function renderNavigation() {}
            function renderWizardStep(step) {}
            function setDynamicBackground() {}

            // --- SECTION 1: STATE MANAGEMENT & DATA ---
            const state = {
                currentView: 'landing-view', wizardStep: 0, builderStep: 0,
                allSections: [
                    { id: 'parties', title: "Parties, Guardians & Children", icon: 'fa-users', render: renderPartiesSection, collect: collectPartiesData, generate: generatePartiesDoc },
                    { id: 'custody', title: 'Custody & Activity Schedule', icon: 'fa-calendar-days', render: renderCustodySection, collect: collectCustodyData, generate: generateCustodyDoc },
                    { id: 'expenses', title: 'Expense & Benefit Tracker', icon: 'fa-hand-holding-dollar', render: renderExpensesSection, collect: collectExpensesData, generate: generateExpensesDoc },
                    { id: 'communication', title: 'Communication Plan', icon: 'fa-comments', render: renderCommunicationSection, collect: collectCommunicationData, generate: generateCommunicationDoc },
                    { id: 'summary', title: 'Summary & Generation', icon: 'fa-check-double', render: renderSummarySection, collect: () => {}, generate: () => '' },
                ],
                selectedSections: [], planData: {}, partyNames: { A: 'Parent A', B: 'Parent B' }
            };

            const dropdownOptions = {
                relationship: ['Father', 'Mother', 'Grandfather', 'Grandmother', 'Uncle', 'Aunt', 'Legal Guardian', 'Other'],
                addressType: ['Home', 'Work', 'Postal', 'Other'],
                contactType: ['Primary Cell', 'Work Phone', 'Email', 'WhatsApp', 'Facebook', 'Other'],
                eventType: ['Contact Schedule', 'Visitation', 'Holiday', 'Emergency', 'School Activity', 'Cultural Event', 'Other'],
                custodyDecision: ['Mutual Agreement', 'Court Order', 'In Dispute', 'Other'],
                expenseCategory: ['Living Expenses', 'Education', 'Healthcare', 'Cultural Obligations', 'Other'],
                communicationClassification: ['For Urgent Matters', 'For Formal Communication', 'For Daily Updates']
            };

            // --- SECTION 2: DOM ELEMENT REFERENCES ---
            const views = {
                'landing-view': document.getElementById('landing-view'),
                'wizard-view': document.getElementById('wizard-view'),
                'builder-view': document.getElementById('builder-view')
            };
            const buttons = {
                startWizard: document.getElementById('start-wizard-btn'),
                startManual: document.getElementById('start-manual-btn'),
                savePlan: document.getElementById('save-plan-btn')
            };
            const containers = {
                steps: document.getElementById('steps-container'),
                navigation: document.getElementById('navigation-container'),
                sidebar: document.getElementById('sidebar-placeholder')
            };

            // --- SECTION 3: EVENT LISTENERS ---
            buttons.startWizard.addEventListener('click', () => {
                switchView('wizard-view');
                // Add wizard logic here
            });
            buttons.startManual.addEventListener('click', () => {
                switchView('builder-view');
                // For demo, render all sections
                state.selectedSections = state.allSections.map(s => s.id);
                renderBuilder(state.selectedSections);
            });
            document.getElementById('alert-modal-close').addEventListener('click', () => {
                document.getElementById('alert-modal').style.display = 'none';
            });
            // Disclaimer modal logic
            const disclaimerAgree = document.getElementById('disclaimer-agree');
            const disclaimerProceed = document.getElementById('disclaimer-proceed');
            disclaimerAgree.addEventListener('change', () => {
                disclaimerProceed.disabled = !disclaimerAgree.checked;
            });
            document.getElementById('disclaimer-cancel').addEventListener('click', () => {
                document.getElementById('disclaimer-modal').style.display = 'none';
                disclaimerAgree.checked = false;
                disclaimerProceed.disabled = true;
            });
            disclaimerProceed.addEventListener('click', () => {
                document.getElementById('disclaimer-modal').style.display = 'none';
                disclaimerAgree.checked = false;
                disclaimerProceed.disabled = true;
                // Continue with document generation
            });

            // Set initial background
            setDynamicBackground();

            // Hide all views except landing
            switchView('landing-view');
        });
    </script>
</body>
</html>
