<!DOCTYPE html>
<html>
<head>
    <!-- This script loads the main template and injects this course's content -->
    <script>
        // Use a ROOT-RELATIVE path to be more robust. This assumes the template
        // is always located at /training/course-template.html on your server.
        fetch('/training/course-template.html')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status} - Could not load template from '/training/course-template.html'`);
                }
                return response.text();
            })
            .then(templateHtml => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(templateHtml, 'text/html');

                // Set the specific title for this course
                doc.title = "Khulu Courses: The Constitution, Your Ultimate Shield";

                // Inject this page's unique content into the template's placeholder
                const placeholder = doc.getElementById('course-content-placeholder');
                const sourceContent = document.getElementById('course-content-source');
                if (placeholder && sourceContent) {
                    placeholder.innerHTML = sourceContent.innerHTML;
                }
                
                // Replace the current document with the new, templated document
                document.documentElement.innerHTML = doc.documentElement.innerHTML;
                
                // Manually execute the course-specific script after the DOM is updated
                setTimeout(() => {
                    const courseScript = document.querySelector('#course-content-placeholder script');
                    if (courseScript) {
                        eval(courseScript.innerHTML);
                    }
                }, 0);
            })
            .catch(e => {
                console.error("Failed to load course template:", e);
                document.body.innerHTML = `<div style="color: red; font-family: sans-serif; padding: 2rem;">
                    <h1>Error: Template Not Found</h1>
                    <p>Could not load '/training/course-template.html'. Please ensure it is in the same directory as this course file.</p>
                    <p><strong>Details:</strong> ${e.message}</p>
                </div>`;
            });
    </script>
</head>
<body>
    <!-- 
      The unique content and script for this specific course.
      It will be grabbed by the script above and injected into the template.
    -->
    <div id="course-content-source" style="display: none;">
        
        <!-- Original, unique HTML content for this course -->
         <div id="course-hub" class="max-w-4xl mx-auto">
            <header class="text-center mb-12">
                <div class="flex justify-center items-center gap-4 mb-4">
                    <svg class="h-16 w-16 text-yellow-400" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="1.5">
                        <path d="M12 2L4 5v6.09c0 4.97 3.58 9.38 8 10.91c4.42-1.53 8-5.94 8-10.91V5L12 2z" />
                    </svg>
                    <h1 class="text-4xl md:text-5xl font-bold font-roboto-slab text-white">The Constitution: Your Ultimate Shield</h1>
                </div>
                <p class="text-lg text-gray-300">As a Khulu, a father, an elderâ€”your wisdom is the shield that protects your family. This course sharpens that shield with the supreme law of the land.</p>
            </header>

            <section class="mb-12">
                <h2 class="text-2xl font-bold text-center text-orange-400 mb-6">Step 1: Choose Your Area of Knowledge</h2>
                <div id="topic-selection" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="topic-card bg-slate-800/80 backdrop-blur-sm p-6 rounded-xl text-center cursor-pointer" data-topic="bill_of_rights">
                         <i class="fas fa-users text-4xl text-blue-400 mb-3"></i>
                        <h3 class="text-xl font-bold text-white mb-2">The Bill of Rights</h3>
                        <p class="text-gray-400 text-sm">Understand the fundamental rights that protect you and your children, from equality to dignity.</p>
                    </div>
                    <div class="topic-card bg-slate-800/80 backdrop-blur-sm p-6 rounded-xl text-center cursor-pointer" data-topic="branches">
                         <i class="fas fa-sitemap text-4xl text-green-400 mb-3"></i>
                        <h3 class="text-xl font-bold text-white mb-2">Structure of State</h3>
                        <p class="text-gray-400 text-sm">Learn how power is balanced between the Legislature, Executive, and Judiciary.</p>
                    </div>
                    <div class="topic-card bg-slate-800/80 backdrop-blur-sm p-6 rounded-xl text-center cursor-pointer" data-topic="customary_law">
                         <i class="fas fa-feather-alt text-4xl text-yellow-400 mb-3"></i>
                        <h3 class="text-xl font-bold text-white mb-2">Customary Law & The Constitution</h3>
                        <p class="text-gray-400 text-sm">Explore how traditional law interacts with and is subject to the supreme law of the land.</p>
                    </div>
                </div>
            </section>

            <section class="mb-12 hidden" id="level-selection-section">
                <h2 class="text-2xl font-bold text-center text-orange-400 mb-6">Step 2: Choose Your Level of Wisdom</h2>
                <div id="level-selection" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="level-card bg-slate-800/80 backdrop-blur-sm p-6 rounded-xl text-center cursor-pointer" data-level="1">
                        <i class="fas fa-star text-3xl text-yellow-500 mb-3"></i>
                        <h3 class="text-xl font-bold text-white">Beginner</h3>
                        <p class="text-gray-400 text-sm">Learn the fundamentals.</p>
                    </div>
                    <div class="level-card bg-slate-800/80 backdrop-blur-sm p-6 rounded-xl text-center cursor-pointer" data-level="2">
                       <div class="flex justify-center mb-3"><i class="fas fa-star text-3xl text-yellow-500"></i><i class="fas fa-star text-3xl text-yellow-500"></i></div>
                        <h3 class="text-xl font-bold text-white">Intermediate</h3>
                        <p class="text-gray-400 text-sm">Test your growing knowledge.</p>
                    </div>
                    <div class="level-card bg-slate-800/80 backdrop-blur-sm p-6 rounded-xl text-center cursor-pointer" data-level="3">
                        <div class="flex justify-center mb-3"><i class="fas fa-star text-3xl text-yellow-500"></i><i class="fas fa-star text-3xl text-yellow-500"></i><i class="fas fa-star text-3xl text-yellow-500"></i></div>
                        <h3 class="text-xl font-bold text-white">Elder's Wisdom</h3>
                        <p class="text-gray-400 text-sm">Master the law like a Khulu.</p>
                    </div>
                </div>
            </section>

            <div class="text-center">
                <button id="start-course-btn" class="hidden bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-12 rounded-lg text-lg">Begin Lesson</button>
            </div>
        </div>

        <div id="quiz-area" class="course-container ndebele-border w-full max-w-3xl rounded-2xl shadow-2xl p-8 mx-auto hidden">
            <div class="mb-6 text-center">
                <h2 class="text-2xl font-bold font-roboto-slab text-yellow-400" id="quiz-title">Quiz Title</h2>
                <p class="text-indigo-300">Level <span id="level-display">1</span></p>
            </div>
            
            <div class="w-full bg-gray-700 rounded-full h-2.5 mb-4"><div id="progress-bar" class="bg-yellow-500 h-2.5 rounded-full transition-width duration-500" style="width: 0%"></div></div>

            <div id="question-container" class="bg-gray-800/70 backdrop-blur-sm p-6 rounded-lg">
                <h3 id="question-text" class="text-xl font-semibold mb-4 min-h-[60px]"></h3>
                <select id="answer-options" class="bg-gray-200 text-gray-800 p-3 rounded-lg w-full text-lg">
                    <option value="" disabled selected>Select your answer</option>
                </select>
            </div>
            
            <div id="feedback-container" class="mt-4 min-h-[120px]"></div>

            <div class="flex justify-between items-center mt-4">
                 <button id="back-to-hub-btn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-6 rounded-lg">Change Topic</button>
                 <button id="next-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-8 rounded-lg hidden">Next</button>
            </div>
        </div>

        <div id="end-screen" class="text-center hidden bg-slate-800/80 backdrop-blur-sm p-8 rounded-xl">
             <h2 class="text-4xl font-bold font-roboto-slab text-green-400">Course Complete!</h2>
             <p class="text-xl mt-4">You have mastered the foundations of your rights. Your wisdom is a shield for your family.</p>
             <p class="text-2xl mt-2">Final Score: <span id="final-score" class="font-bold"></span></p>
             <i class="fas fa-award text-8xl text-yellow-400 my-6"></i>
             <button id="restart-btn" class="bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-3 px-10 rounded-lg text-xl">Start Over</button>
        </div>
        
        <!-- Original, unique script for this course's interactivity -->
        <script>
            const courseHub = document.getElementById('course-hub');
            const quizArea = document.getElementById('quiz-area');
            const endScreen = document.getElementById('end-screen');
            
            const topicCards = document.querySelectorAll('.topic-card');
            const levelCards = document.querySelectorAll('.level-card');
            const levelSelectionSection = document.getElementById('level-selection-section');
            const startCourseBtn = document.getElementById('start-course-btn');
            const backToHubBtn = document.getElementById('back-to-hub-btn');

            let selectedTopic = null;
            let selectedLevel = null;
            let questions = [];

            const courseData = {
                bill_of_rights: [
                    { q: "What is the highest law in South Africa?", a: "The Constitution", o: ["The President's rules", "Police regulations"], exp: "The Constitution is the 'Big Rule Book' that everyone, including the President, must follow." },
                    { q: "What does the 'Right to Dignity' mean for a child?", a: "To be treated with respect and not be humiliated.", o: ["To get new toys every day.", "To never be told 'no'." ], exp: "Dignity means everyone deserves to be treated with respect and feel valued, which is a core constitutional right." },
                    { q: "If a school rule says only boys can play soccer, what right might be affected?", a: "The Right to Equality", o: ["The Right to Play", "The Right to Education"], exp: "Correct. Section 9 ensures no one is unfairly discriminated against based on gender." },
                    { q: "What is the 'Best Interests of the Child' principle?", a: "In any matter concerning a child, their well-being is the most important consideration", o: ["The child always gets what they want", "It's a rule for schools only"], exp: "This is a golden rule in our law. It ensures children's safety and development are prioritized." },
                    { q: "If a parent is denied a job unfairly, how could this affect their child's rights?", a: "It can affect the child's right to basic nutrition and shelter.", o: ["It doesn't affect the child.", "The child can get the job instead."], exp: "A parent's ability to provide is directly linked to the child's basic rights. Unfairness to a parent harms the child." }
                ],
                branches: [
                     { q: "Which branch of government MAKES the laws?", a: "Legislature (Parliament)", o: ["Executive (The President)", "Judiciary (The Courts)"], exp: "Parliament's main job is to create, amend, and repeal laws for the country." },
                     { q: "Who is the head of the Executive branch?", a: "The President", o: ["The Chief Justice", "The Speaker of Parliament"], exp: "The President, along with the Cabinet, is responsible for implementing and enforcing the laws." },
                     { q: "What is the main role of the Judiciary?", a: "To interpret laws and ensure they are applied fairly.", o: ["To arrest criminals.", "To write new laws."], exp: "The courts and judges make up the Judiciary. Their job is to settle disputes and act as guardians of the Constitution." },
                     { q: "Why is it important to have three separate branches of government?", a: "To prevent any one branch from becoming too powerful.", o: ["To make government more complicated.", "To create more jobs for politicians."], exp: "This 'separation of powers' is a key check and balance in our democracy, protecting citizens from abuse of power." },
                     { q: "If Parliament passes a law that contradicts the Bill of Rights, which branch can declare it invalid?", a: "The Judiciary (specifically the Constitutional Court)", o: ["The Executive", "The Police"], exp: "The courts have the power of judicial review to ensure all laws are constitutional." }
                ],
                customary_law: [
                    { q: "Is customary law recognized by the South African Constitution?", a: "Yes, as long as it is consistent with the Constitution.", o: ["No, only Western law is recognized.", "Yes, it is superior to the Constitution."], exp: "The Constitution respects customary law but holds that it, like all law, must align with the Bill of Rights." },
                    { q: "If a customary inheritance rule states that only sons can inherit property, what constitutional right does this challenge?", a: "The Right to Equality", o: ["The Right to Property", "The Right to Culture"], exp: "The right to equality (Section 9) prevents unfair discrimination on the basis of gender, which would take precedence here." },
                    { q: "What is the role of traditional leaders in the modern legal system?", a: "They can preside over certain civil matters in traditional courts.", o: ["They can create national laws.", "They have no legal role."], exp: "The role of traditional leaders is recognized, but their authority is subject to the Constitution and national legislation." },
                    { q: "The concept of 'Ubuntu' is central to many African cultures. How does it relate to the Constitution?", a: "It reflects the constitutional values of human dignity, equality, and community.", o: ["It is not related to the Constitution.", "It is a political party."], exp: "Ubuntu's emphasis on interconnectedness and respect for others is a foundational value that underpins many of our constitutional rights." },
                    { q: "Can a person be forced to follow a customary practice that goes against their constitutional rights?", a: "No, constitutional rights are supreme.", o: ["Yes, tradition must always be followed.", "Only if the Chief says so."], exp: "An individual's constitutional rights, like the right to dignity and bodily integrity, cannot be violated by cultural or traditional practices." }
                ]
            };
            
            const levelDisplay = document.getElementById('level-display');
            const progressBar = document.getElementById('progress-bar');
            const questionTextEl = document.getElementById('question-text');
            const answerOptionsEl = document.getElementById('answer-options');
            const feedbackContainer = document.getElementById('feedback-container');
            const nextBtn = document.getElementById('next-btn');
            const restartBtn = document.getElementById('restart-btn');
            const finalScoreEl = document.getElementById('final-score');
            const quizTitleEl = document.getElementById('quiz-title');

            let currentQuestionIndex, score, incorrectAttempts;

            function selectCard(card, cardType) {
                const container = document.getElementById(`${cardType}-selection`);
                container.querySelectorAll(`.${cardType}-card`).forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');

                if (cardType === 'topic') {
                    selectedTopic = card.dataset.topic;
                    levelSelectionSection.classList.remove('hidden');
                    quizTitleEl.textContent = card.querySelector('h3').textContent;
                } else if (cardType === 'level') {
                    selectedLevel = parseInt(card.dataset.level);
                }

                if (selectedTopic && selectedLevel) {
                    startCourseBtn.classList.remove('hidden');
                }
            }

            function startCourse() {
                courseHub.classList.add('hidden');
                quizArea.classList.remove('hidden');
                const allQuestions = courseData[selectedTopic];
                const questionsPerLevel = Math.ceil(allQuestions.length / 3);
                const startIndex = (selectedLevel - 1) * questionsPerLevel;
                const endIndex = Math.min(startIndex + questionsPerLevel, allQuestions.length);
                questions = allQuestions.slice(startIndex, endIndex);
                
                initGame();
            }

            function initGame() {
                currentQuestionIndex = 0;
                score = 0;
                quizArea.classList.remove('hidden');
                endScreen.classList.add('hidden');
                levelDisplay.textContent = selectedLevel;
                loadQuestion();
                updateProgress();
            }

            function loadQuestion() {
                resetUI();
                const questionData = questions[currentQuestionIndex];
                questionTextEl.textContent = questionData.q;
                
                const options = shuffleArray([...questionData.o, questionData.a]);
                answerOptionsEl.innerHTML = '<option value="" disabled selected>Select your answer</option>';
                options.forEach(opt => {
                    const optionEl = document.createElement('option');
                    optionEl.value = opt;
                    optionEl.textContent = opt;
                    answerOptionsEl.appendChild(optionEl);
                });
                updateProgress();
            }

            function checkAnswer() {
                const selectedAnswer = answerOptionsEl.value;
                if (!selectedAnswer) return;

                const correctAnswer = questions[currentQuestionIndex].a;
                answerOptionsEl.disabled = true;

                if (selectedAnswer === correctAnswer) {
                    feedbackContainer.innerHTML = `<div class="p-4 bg-green-900/50 rounded-lg border-l-4 border-green-500"><p class="font-bold">Correct!</p><p class="text-sm">${questions[currentQuestionIndex].exp}</p></div>`;
                    if(!incorrectAttempts) score += 10;
                    nextBtn.classList.remove('hidden');
                } else {
                    incorrectAttempts = (incorrectAttempts || 0) + 1;
                    feedbackContainer.innerHTML = `<div class="p-4 bg-red-900/50 rounded-lg border-l-4 border-red-500"><p class="font-bold">Not quite.</p><p class="text-sm">That's not the correct answer. The correct answer is: <strong>${correctAnswer}</strong></p></div>`;
                    nextBtn.classList.remove('hidden');
                }
            }
            
            function handleNext() {
                currentQuestionIndex++;
                if (currentQuestionIndex < questions.length) {
                    loadQuestion();
                } else {
                    showEndScreen();
                }
            }

            function showEndScreen() {
                quizArea.classList.add('hidden');
                endScreen.classList.remove('hidden');
                finalScoreEl.textContent = `${score} / ${questions.length * 10}`;
            }

            function resetUI() {
                feedbackContainer.innerHTML = '';
                nextBtn.classList.add('hidden');
                answerOptionsEl.disabled = false;
                answerOptionsEl.value = '';
                incorrectAttempts = 0;
            }

            function updateProgress() {
                const progress = (currentQuestionIndex / questions.length) * 100;
                progressBar.style.width = `${progress}%`;
            }

            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            function goBackToHub() {
                quizArea.classList.add('hidden');
                endScreen.classList.add('hidden');
                courseHub.classList.remove('hidden');
                levelSelectionSection.classList.add('hidden');
                startCourseBtn.classList.add('hidden');
                topicCards.forEach(c => c.classList.remove('selected'));
                levelCards.forEach(c => c.classList.remove('selected'));
                selectedTopic = null;
                selectedLevel = null;
            }

            topicCards.forEach(card => card.addEventListener('click', () => selectCard(card, 'topic')));
            levelCards.forEach(card => card.addEventListener('click', () => selectCard(card, 'level')));
            startCourseBtn.addEventListener('click', startCourse);
            backToHubBtn.addEventListener('click', goBackToHub);
            answerOptionsEl.addEventListener('change', checkAnswer);
            nextBtn.addEventListener('click', handleNext);
            restartBtn.addEventListener('click', goBackToHub);
        </script>
    </div>
</body>
</html>
