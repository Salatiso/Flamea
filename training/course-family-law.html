<!DOCTYPE html>
<html>
<head>
    <!-- This script loads the main template and injects this course's content -->
    <script>
        fetch('course-template.html')
            .then(response => response.text())
            .then(templateHtml => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(templateHtml, 'text/html');

                // Set the specific title for this course
                doc.title = "FLAMEA Training - Family Law Overview";

                // Inject this page's unique content into the template's placeholder
                const placeholder = doc.getElementById('course-content-placeholder');
                const sourceContent = document.getElementById('course-content-source');
                if (placeholder && sourceContent) {
                    placeholder.innerHTML = sourceContent.innerHTML;
                }
                
                // Replace the current document with the new, templated document
                document.documentElement.innerHTML = doc.documentElement.innerHTML;
                
                // Manually execute the course-specific script after the DOM is updated
                const courseScript = document.querySelector('#course-content-placeholder script');
                if (courseScript) {
                    eval(courseScript.innerHTML);
                }
            });
    </script>
</head>
<body class="bg-gray-900 text-gray-200 font-sans flex">

    <aside id="training-sidebar-placeholder" class="w-64 h-screen sticky top-0"></aside>

    <div class="flex-1 flex flex-col">
        <main class="main-content p-4 md:p-8 flex items-center justify-center">
            
            <div id="course-hub" class="max-w-4xl mx-auto text-center">
                <header class="mb-12">
                     <div class="flex justify-center items-center gap-4 mb-4">
                        <svg class="h-20 w-20 text-blue-400" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                           <path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C7.93 2 4.51 5.36 4.51 9.5C4.51 14.14 8.71 18.81 11.53 21.41C11.83 21.68 12.17 21.68 12.47 21.41C15.29 18.81 19.49 14.14 19.49 9.5C19.49 5.36 16.07 2 12 2ZM12 11.5C10.62 11.5 9.5 10.38 9.5 9C9.5 7.62 10.62 6.5 12 6.5C13.38 6.5 14.5 7.62 14.5 9C14.5 10.38 13.38 11.5 12 11.5Z"/>
                        </svg>
                        <h1 class="text-4xl md:text-5xl font-bold font-roboto-slab text-white">Family Law Overview</h1>
                    </div>
                    <p class="text-lg text-gray-300">Understand the laws governing marriage, divorce, and domestic partnerships.</p>
                </header>

                <section id="module-selection-section">
                    <h2 class="text-2xl font-bold text-center text-orange-400 mb-6">Choose a Module to Begin</h2>
                    <div id="module-selection" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="module-card bg-slate-800/80 p-6 rounded-xl cursor-pointer" data-module="1">
                            <h3 class="text-xl font-bold text-white mb-2">Marriage Regimes</h3>
                            <p class="text-gray-400 text-sm">Learn the critical differences between In and Out of Community of Property.</p>
                        </div>
                        <div class="module-card bg-slate-800/80 p-6 rounded-xl cursor-pointer" data-module="2">
                            <h3 class="text-xl font-bold text-white mb-2">The Divorce Process</h3>
                            <p class="text-gray-400 text-sm">Understand the steps involved in dissolving a marriage legally in South Africa.</p>
                        </div>
                        <div class="module-card bg-slate-800/80 p-6 rounded-xl cursor-pointer" data-module="3">
                            <h3 class="text-xl font-bold text-white mb-2">Maintenance & Protection</h3>
                            <p class="text-gray-400 text-sm">Learn about the laws governing child maintenance and protection orders.</p>
                        </div>
                    </div>
                </section>
            </div>
            
            <div id="content-area" class="w-full max-w-4xl mx-auto hidden">
                <div id="module-content" class="prose max-w-none prose-invert mb-8 bg-slate-800/70 p-6 rounded-lg"></div>
                <button id="start-quiz-btn" class="btn btn-primary w-full">Test Your Knowledge</button>
                <section id="quiz-section" class="quiz-section mt-8 p-8 rounded-lg hidden"></section>
                <div id="end-screen" class="end-screen mt-8 p-8 rounded-lg hidden text-center"></div>
                <button id="back-to-hub-btn" class="btn btn-secondary mt-4">Back to Modules</button>
            </div>
        </main>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        fetch('/training-sidebar.html')
            .then(response => response.text())
            .then(html => {
                const placeholder = document.getElementById('training-sidebar-placeholder');
                if (placeholder) {
                    placeholder.innerHTML = html;
                    // Re-run accordion logic if it's in the loaded sidebar
                    const scriptEl = placeholder.querySelector('script');
                    if (scriptEl) {
                        eval(scriptEl.innerHTML);
                    }
                }
            }).catch(error => console.error('Error fetching training sidebar:', error));

        const courseHub = document.getElementById('course-hub');
        const contentArea = document.getElementById('content-area');
        const moduleContentEl = document.getElementById('module-content');
        const quizSection = document.getElementById('quiz-section');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const backToHubBtn = document.getElementById('back-to-hub-btn');
        const endScreen = document.getElementById('end-screen');
        const moduleCards = document.querySelectorAll('.module-card');

        const courseContent = {
            1: {
                title: 'Module 1: Understanding Marriage Regimes in South Africa',
                content: `
                    <p>One of the first and most critical decisions a couple makes is their <strong>marital regime</strong>. This choice has significant financial consequences, especially during a divorce. In South Africa, there are three main types.</p>
                    <h3>Types of Marriages</h3>
                    <ul>
                        <li><strong>Civil Marriage:</strong> A monogamous marriage governed by the Marriage Act.</li>
                        <li><strong>Civil Union:</strong> Allows same-sex or opposite-sex couples to enter into a legal union with the same consequences.</li>
                        <li><strong>Customary Marriage:</strong> A marriage concluded according to indigenous African customary law.</li>
                    </ul>
                    <h3>Financial Consequences</h3>
                    <p>If you do not sign an Antenuptial Contract (ANC) before getting married, you are automatically married <strong>In Community of Property</strong>. This means all assets and debts are shared equally. The other options, created via an ANC, are <strong>Out of Community of Property</strong> (with or without the accrual system).</p>
                `,
                questions: [
                    { q: "If a couple marries without an Antenuptial Contract (ANC), what is their default marital regime?", a: "In Community of Property", o: ["Out of Community of Property", "A Civil Union"] },
                    { q: "Which Act governs marriages for same-sex couples?", a: "The Civil Union Act", o: ["The Marriage Act", "The Customary Marriages Act"] }
                ]
            },
            2: {
                title: 'Module 2: The Divorce Process',
                content: `
                    <p>The divorce process in South Africa is governed by the Divorce Act. It is a no-fault system, meaning you do not need to prove that your spouse did something wrong; you only need to state that the marriage has broken down irretrievably.</p>
                    <h3>Key Steps</h3>
                    <ul>
                        <li><strong>Summons:</strong> One spouse (the Plaintiff) serves a divorce summons on the other (the Defendant).</li>
                        <li><strong>Pleadings:</strong> The Defendant can then file a notice to defend and a plea.</li>
                        <li><strong>Settlement or Trial:</strong> Most divorces are settled out of court. If an agreement on the division of assets and care of children can be reached, it is made an order of the court. If not, the matter proceeds to trial.</li>
                    </ul>
                    <h3>Role of the Family Advocate</h3>
                    <p>If there are minor children involved, the Family Advocate's office must be involved. Their role is to investigate the circumstances and make a recommendation to the court based on the <strong>child's best interests</strong>.</p>
                `,
                questions: [
                    { q: "Does South Africa have a 'no-fault' divorce system?", a: "Yes, you only need to prove the marriage has broken down.", o: ["No, you must prove your spouse was at fault.", "Only for civil unions."] },
                    { q: "Whose role is it to represent the child's best interests in a divorce?", a: "The Family Advocate", o: ["The Plaintiff's lawyer", "The Judge"] }
                ]
            },
            3: {
                title: 'Module 3: Maintenance & Protection',
                content: `
                    <h3>Child Maintenance</h3>
                    <p>Both parents have a legal duty to support their children financially according to their respective means. This is governed by the Maintenance Act. If a parent fails to pay, the other can approach the Maintenance Court for an order.</p>
                    <h3>Spousal Maintenance</h3>
                    <p>In some cases, a court may order one spouse to pay maintenance to the other after a divorce. This is not automatic and depends on factors like age, earning capacity, and the standard of living during the marriage.</p>
                    <h3>Protection Orders</h3>
                    <p>The Domestic Violence Act provides protection for victims of domestic abuse. A person can apply to the court for a protection order, which can prevent the abuser from contacting or coming near them. Violating a protection order is a criminal offence.</p>
                `,
                questions: [
                    { q: "Who has a legal duty to financially support a child?", a: "Both parents, according to their means", o: ["Only the father", "Only the parent the child lives with"] },
                    { q: "What Act provides protection for victims of domestic abuse?", a: "The Domestic Violence Act", o: ["The Divorce Act", "The Maintenance Act"] }
                ]
            }
        };

        let currentModuleData = {}; let currentQuestionIndex = 0; let score = 0;

        function displayModule(moduleNum) {
            currentModuleData = courseContent[moduleNum];
            courseHub.classList.add('hidden');
            contentArea.classList.remove('hidden');
            quizSection.classList.add('hidden');
            endScreen.classList.add('hidden');
            startQuizBtn.classList.remove('hidden');
            moduleContentEl.innerHTML = `<h2>${currentModuleData.title}</h2>${currentModuleData.content}`;
        }
        
        function setupQuiz() {
            startQuizBtn.classList.add('hidden');
            quizSection.classList.remove('hidden');
            currentQuestionIndex = 0;
            score = 0;
            loadQuestion();
        }

        function loadQuestion() {
            const questionData = currentModuleData.questions[currentQuestionIndex];
            let optionsHTML = shuffleArray([...questionData.o, questionData.a]).map(opt => `<div class="quiz-option p-3 rounded-lg border border-gray-600 hover:bg-slate-700 cursor-pointer" data-answer="${opt === questionData.a}">${opt}</div>`).join('');
            quizSection.innerHTML = `<p class="font-semibold text-lg mb-4">${currentQuestionIndex + 1}. ${questionData.q}</p><div class="space-y-3">${optionsHTML}</div><div class="feedback mt-4 text-sm p-3 rounded-lg"></div>`;
        }

        function handleAnswerClick(e) {
            if (!e.target.classList.contains('quiz-option')) return;
            const selectedOption = e.target;
            const isCorrect = selectedOption.dataset.answer === 'true';
            const feedbackDiv = quizSection.querySelector('.feedback');
            
            quizSection.querySelectorAll('.quiz-option').forEach(opt => opt.style.pointerEvents = 'none');

            if (isCorrect) {
                selectedOption.classList.add('bg-green-500/50', 'border-green-500');
                feedbackDiv.innerHTML = '<p class="text-green-400 font-bold">Correct! Knowledge is power.</p>';
                score++;
            } else {
                selectedOption.classList.add('bg-red-500/50', 'border-red-500');
                feedbackDiv.innerHTML = '<p class="text-red-400 font-bold">Not quite. Review the module content to strengthen your understanding.</p>';
            }

            setTimeout(() => {
                currentQuestionIndex++;
                if (currentQuestionIndex < currentModuleData.questions.length) {
                    loadQuestion();
                } else {
                    showEndScreen();
                }
            }, 2500);
        }

        function showEndScreen() {
            quizSection.classList.add('hidden');
            endScreen.classList.remove('hidden');
            endScreen.innerHTML = `<h2 class="text-2xl font-bold font-roboto-slab text-green-400">Module Complete!</h2><p class="text-lg mt-2">You scored ${score} out of ${currentModuleData.questions.length}.</p><p class="mt-4">You have a solid foundation in Family Law.</p>`;
        }
        
        function goBackToHub() {
            contentArea.classList.add('hidden');
            courseHub.classList.remove('hidden');
            moduleCards.forEach(c => c.classList.remove('selected'));
        }

        function shuffleArray(array) { return [...array].sort(() => Math.random() - 0.5); }

        moduleCards.forEach(card => card.addEventListener('click', () => {
            selectCard(card, 'module');
            displayModule(parseInt(card.dataset.module));
        }));
        startQuizBtn.addEventListener('click', setupQuiz);
        quizSection.addEventListener('click', handleAnswerClick);
        backToHubBtn.addEventListener('click', goBackToHub);
        
        function selectCard(card, cardType) {
            document.querySelectorAll(`.${cardType}-card`).forEach(c => c.classList.remove('selected'));
            card.classList.add('selected');
        }
    });
    </script>
</body>
</html>
