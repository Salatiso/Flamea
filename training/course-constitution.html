<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FLAMEA Training - The SA Constitution</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700;900&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { font-family: 'Open Sans', sans-serif; scroll-behavior: smooth; }
        .main-container { display: grid; grid-template-columns: 280px 1fr; height: 100vh; width: 100vw; overflow: hidden; }
        .main-content { overflow-y: auto; }
        .sidebar-direct-link { transition: all 0.3s ease; transform: translateX(0); }
        .sidebar-direct-link:hover, .sidebar-direct-link.active { background-color: #2563EB; color: white; transform: translateX(10px); }
        .prose h2 { font-size: 1.8rem; font-weight: 700; margin-top: 2rem; margin-bottom: 1rem; border-bottom: 2px solid #34D399; padding-bottom: 0.5rem; color: #6EE7B7;}
        .prose h3 { font-size: 1.3rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.75rem; color: #A7F3D0;}
        .prose p { margin-bottom: 1rem; line-height: 1.7; font-size: 1.1rem; }
        .prose strong { color: #A7F3D0; }
        .prose ul { list-style-type: disc; margin-left: 1.5rem; margin-bottom: 1rem; }
        .prose a { color: #60A5FA; text-decoration: underline; }
        .quiz-option { cursor: pointer; transition: background-color 0.2s; }
        .quiz-option:hover { background-color: #374151; }
        .quiz-option.selected { background-color: #2563EB; border-color: #3B82F6; }
        .module { display: none; }
        .module.active { display: block; }
        .quiz-section { display: none; }
        .quiz-section.active { display: block; }
        .certificate-modal { display: none; }
        .certificate-modal.active { display: flex; }
        .progress-bar-container { background-color: #4B5563; }
        .progress-bar-fill { background-color: #34D399; transition: width 0.5s ease-in-out; }
    </style>
</head>
<body class="bg-gray-800 text-white">
    <div class="main-container">
        <!-- Sidebar -->
        <aside class="bg-gray-900 p-6 flex flex-col">
            <a href="../index.html" class="text-3xl font-black font-roboto mb-12 text-center">FLAME<span class="text-green-400">A</span></a>
            <nav id="main-nav" class="flex flex-col space-y-2">
                 <a href="../training.html" class="sidebar-direct-link active flex items-center p-4 rounded-lg"><i class="fas fa-arrow-left w-6 text-center mr-4"></i> Back to Training Hub</a>
                 <div class="border-t border-gray-700 my-2"></div>
                 <h4 class="text-gray-400 font-bold uppercase tracking-wider px-4 text-sm">Course Progress</h4>
                 <a href="#module1" class="sidebar-direct-link flex items-center p-3 rounded-lg text-sm">Module 1: Foundations</a>
                 <a href="#module2" id="module2-link" class="sidebar-direct-link flex items-center p-3 rounded-lg text-sm text-gray-500 pointer-events-none">Module 2: The Bill of Rights</a>
                 <a href="#module3" id="module3-link" class="sidebar-direct-link flex items-center p-3 rounded-lg text-sm text-gray-500 pointer-events-none">Module 3: Structure of State</a>
            </nav>
            <div id="auth-reminder" class="mt-auto text-center bg-yellow-900 bg-opacity-30 p-3 rounded-lg border border-yellow-500 hidden">
                <p class="text-xs text-yellow-200">Your progress is not being saved. <a href="../login.html" class="font-bold underline">Login or Register</a> for free to track your journey and earn certificates.</p>
            </div>
            <div class="mt-4 text-center">
                <p class="text-xs text-gray-500">&copy; <span id="currentYear"></span> Flamea.org</p>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content p-8 md:p-12">
            <div class="max-w-4xl mx-auto">
                <!-- Course Header -->
                <div class="mb-8">
                    <h1 class="text-4xl font-bold font-roboto text-green-400">Foundational Module: The SA Constitution</h1>
                    <p class="text-lg text-gray-400 mt-2">Understand the supreme law that underpins all your rights as a father and a citizen.</p>
                </div>
                
                <!-- Progress Bar -->
                <div class="w-full progress-bar-container rounded-full h-2.5 mb-8">
                    <div id="progress-bar" class="progress-bar-fill h-2.5 rounded-full" style="width: 0%"></div>
                </div>

                <!-- Course Content Area -->
                <div class="prose max-w-none prose-invert">
                    <!-- Module 1: Foundations (Initially Active) -->
                    <div id="module1" class="module active">
                        <section id="intro">
                            <h2>Module 1: Foundations of the Constitution</h2>
                            <p>In any legal matter in South Africa, the <strong>Constitution of the Republic of South Africa, 1996</strong>, is the most important document. It is the <strong>supreme law</strong> of the land. This means no other law, no court ruling, and no government action can go against what the Constitution says. For fathers, it is your ultimate shield and your strongest tool.</p>
                             <h3>A. The Constitution's Supremacy (50% Focus)</h3>
                            <p>Section 2 of the Constitution declares its own supremacy. Think of it as the ultimate foundation of a house. All other laws (like the Children's Act, the Maintenance Act) are the walls and the roof. If any wall or roof section is not built correctly according to the foundation's plan, it is invalid and must be fixed or removed. This principle is vital because it means that even if a specific law seems to disadvantage you, if it contradicts the foundational principles of equality and dignity in the Constitution, it can be challenged.</p>
                            <!-- SVG Diagram -->
                            <div class="bg-gray-900 p-6 rounded-lg my-6">
                                <svg width="100%" viewBox="0 0 400 200" xmlns="http://www.w3.org/2000/svg">
                                    <style>.svg-text{font-family: 'Open Sans', sans-serif; fill: white;} .svg-text-bold{font-weight: bold;}</style>
                                    <rect x="100" y="10" width="200" height="40" rx="5" fill="#10B981"/><text x="200" y="35" text-anchor="middle" class="svg-text svg-text-bold">SA Constitution (Supreme Law)</text>
                                    <path d="M 200 50 V 80" stroke="#4B5563" stroke-width="2"/><path d="M 50 100 H 350" stroke="#4B5563" stroke-width="2"/><path d="M 100 100 V 120" stroke="#4B5563" stroke-width="2"/><path d="M 300 100 V 120" stroke="#4B5563" stroke-width="2"/>
                                    <rect x="25" y="120" width="150" height="30" rx="5" fill="#3B82F6"/><text x="100" y="140" text-anchor="middle" class="svg-text">All Other Acts (e.g. Children's Act)</text>
                                    <rect x="225" y="120" width="150" height="30" rx="5" fill="#3B82F6"/><text x="300" y="140" text-anchor="middle" class="svg-text">All Court Rulings</text>
                                </svg>
                            </div>
                            <h3>B. Key Principles for Fathers (50% Focus)</h3>
                            <p>Two sections are especially important for fathers seeking to enforce their rights:</p>
                            <ul>
                                <li><strong>Section 9: Your Right to Equality.</strong> This is the equality clause. It states that everyone is equal before the law and prohibits unfair discrimination on grounds including race, <strong>gender, sex, and marital status.</strong> For you as a father, this means the law cannot and should not prefer a mother over a father simply because she is a woman. Your rights and responsibilities as a parent are equal.</li>
                                <li><strong>Section 28: The Best Interests of the Child are Paramount.</strong> Section 28(2) states: "A child's best interests are of paramount importance in every matter concerning the child." This is the ultimate test. It's not about the mother's interests or the father's interests; it is about what is objectively best for the child. Every argument you make should be linked to this principle.</li>
                            </ul>
                        </section>
                        <button id="start-quiz1" class="w-full bg-green-600 hover:bg-green-700 font-bold py-3 rounded-lg text-lg mt-8">Start Module 1 Quiz</button>
                    </div>

                    <!-- Module 2: The Bill of Rights -->
                    <div id="module2" class="module">
                        <h2>Module 2: A Deeper Dive into the Bill of Rights</h2>
                        <!-- Content for module 2 -->
                        <p>This module will explore the Bill of Rights in more detail...</p>
                        <button id="start-quiz2" class="w-full bg-green-600 hover:bg-green-700 font-bold py-3 rounded-lg text-lg mt-8">Start Module 2 Quiz</button>
                    </div>

                    <!-- Module 3: Structure of State -->
                    <div id="module3" class="module">
                         <h2>Module 3: Understanding the Structure of the State</h2>
                        <!-- Content for module 3 -->
                        <p>This module explains the different branches of government...</p>
                        <button id="start-quiz3" class="w-full bg-green-600 hover:bg-green-700 font-bold py-3 rounded-lg text-lg mt-8">Start Final Quiz</button>
                    </div>

                    <!-- QUIZZES -->
                    <!-- Quiz 1 -->
                    <section id="quiz1" class="quiz-section mt-12 pt-8 border-t-2 border-gray-700">
                        <h2 class="text-2xl font-bold">Module 1 Quiz: Foundations</h2>
                        <div id="quiz-container1" class="bg-gray-900 p-8 rounded-lg space-y-6">
                            <!-- Question 1 -->
                            <div class="quiz-question">
                                <p class="font-semibold text-lg">1. What is the supreme law of South Africa?</p>
                                <div class="space-y-2 mt-2" data-answer="b">
                                    <div class="quiz-option border border-gray-600 rounded p-3" data-option="a">a) The Children's Act</div>
                                    <div class="quiz-option border border-gray-600 rounded p-3" data-option="b">b) The Constitution</div>
                                    <div class="quiz-option border border-gray-600 rounded p-3" data-option="c">c) A High Court ruling</div>
                                </div>
                            </div>
                            <!-- Question 2 -->
                            <div class="quiz-question">
                                <p class="font-semibold text-lg">2. Which section of the Constitution guarantees your right to be treated equally without gender discrimination?</p>
                                <div class="space-y-2 mt-2" data-answer="a">
                                    <div class="quiz-option border border-gray-600 rounded p-3" data-option="a">a) Section 9</div>
                                    <div class="quiz-option border border-gray-600 rounded p-3" data-option="b">b) Section 28</div>
                                    <div class="quiz-option border border-gray-600 rounded p-3" data-option="c">c) Section 2</div>
                                </div>
                            </div>
                            <!-- Question 3 -->
                             <div class="quiz-question">
                                <p class="font-semibold text-lg">3. What is the most important principle in any legal matter involving a child?</p>
                                <div class="space-y-2 mt-2" data-answer="c">
                                    <div class="quiz-option border border-gray-600 rounded p-3" data-option="a">a) The mother's preference</div>
                                    <div class="quiz-option border border-gray-600 rounded p-3" data-option="b">b) The father's financial contribution</div>
                                    <div class="quiz-option border border-gray-600 rounded p-3" data-option="c">c) The child's best interests</div>
                                </div>
                            </div>
                             <!-- Question 4 -->
                            <div class="quiz-question">
                                <p class="font-semibold text-lg">4. Can a normal Act of Parliament overrule the Constitution?</p>
                                <div class="space-y-2 mt-2" data-answer="b">
                                    <div class="quiz-option border border-gray-600 rounded p-3" data-option="a">a) Yes, if Parliament votes on it.</div>
                                    <div class="quiz-option border border-gray-600 rounded p-3" data-option="b">b) No, the Constitution is supreme.</div>
                                    <div class="quiz-option border border-gray-600 rounded p-3" data-option="c">c) Only in a state of emergency.</div>
                                </div>
                            </div>
                             <!-- Question 5 -->
                            <div class="quiz-question">
                                <p class="font-semibold text-lg">5. The principle of 'equality' in Section 9 means...</p>
                                <div class="space-y-2 mt-2" data-answer="a">
                                    <div class="quiz-option border border-gray-600 rounded p-3" data-option="a">a) Fathers and mothers have equal rights and responsibilities.</div>
                                    <div class="quiz-option border border-gray-600 rounded p-3" data-option="b">b) All parents must earn the same income.</div>
                                    <div class="quiz-option border border-gray-600 rounded p-3" data-option="c">c) Mothers have more rights in court.</div>
                                </div>
                            </div>
                            <button id="submit-quiz1-btn" class="w-full bg-green-600 hover:bg-green-700 font-bold py-3 rounded-lg text-lg">Submit Answers</button>
                            <div id="quiz-results1" class="text-center font-bold text-xl pt-4"></div>
                        </div>
                    </section>
                    <!-- More Quizzes for Module 2 and 3 would go here -->
                </div>
            </div>
        </main>
    </div>

    <!-- Certificate Modal -->
    <div id="certificate-modal" class="certificate-modal fixed inset-0 bg-black bg-opacity-80 items-center justify-center z-50 p-4">
        <div class="bg-gray-800 p-8 rounded-lg shadow-2xl max-w-2xl w-full text-center relative">
            <button id="close-modal-btn" class="absolute top-4 right-4 text-2xl text-gray-400 hover:text-white">&times;</button>
            <div id="certificate-content" class="bg-white text-gray-900 p-10 rounded-md border-8 border-green-500">
                <i class="fas fa-award text-6xl text-yellow-500 mb-4"></i>
                <h2 id="cert-title" class="text-3xl font-bold font-roboto text-gray-800">Certificate of Achievement</h2>
                <p class="text-lg mt-4">This certifies that</p>
                <p id="cert-user-name" class="text-2xl font-bold text-blue-700 my-2">[Member Name]</p>
                <p class="text-lg">has successfully completed</p>
                <p id="cert-level-name" class="text-2xl font-bold text-blue-700 my-2">Module 1: Foundations</p>
                <p id="cert-date" class="text-gray-600 mt-4">on [Date]</p>
                <div id="cert-qr-code" class="mt-6 flex flex-col items-center"></div>
            </div>
            <div class="mt-6 flex gap-4 justify-center">
                <button id="print-cert-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg">Print Certificate</button>
                <a id="next-module-btn" href="#" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg hidden">Start Next Module</a>
                <a href="../training.html" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-6 rounded-lg">Back to Hub</a>
            </div>
        </div>
    </div>


    <script>
        document.getElementById('currentYear').textContent = new Date().getFullYear();

        document.addEventListener('DOMContentLoaded', () => {
            const modules = document.querySelectorAll('.module');
            const quizzes = document.querySelectorAll('.quiz-section');
            const progressBar = document.getElementById('progress-bar');
            
            const startQuiz1Btn = document.getElementById('start-quiz1');
            const submitQuiz1Btn = document.getElementById('submit-quiz1-btn');
            const quizContainer1 = document.getElementById('quiz-container1');
            const resultsDiv1 = document.getElementById('quiz-results1');
            
            const certificateModal = document.getElementById('certificate-modal');
            
            let currentModule = 1;

            const updateProgressBar = () => {
                const progress = ((currentModule - 1) / 3) * 100;
                progressBar.style.width = `${progress}%`;
            };

            const unlockModule = (moduleNumber) => {
                const link = document.getElementById(`module${moduleNumber}-link`);
                if(link) {
                    link.classList.remove('text-gray-500', 'pointer-events-none');
                    link.classList.add('text-white');
                }
            };

            const selectAnswer = (e) => {
                if (e.target.matches('.quiz-option')) {
                    const parentQuestion = e.target.parentElement;
                    parentQuestion.querySelectorAll('.quiz-option').forEach(opt => opt.classList.remove('selected'));
                    e.target.classList.add('selected');
                }
            };

            const showQuiz = (quizNum) => {
                document.getElementById(`module${quizNum}`).classList.add('hidden');
                document.getElementById(`quiz${quizNum}`).classList.add('active');
                 document.getElementById(`quiz${quizNum}`).scrollIntoView();
            };
            
            const showCertificate = (level) => {
                const user = window.flamea && window.flamea.auth ? window.flamea.auth.currentUser : null;
                const userName = user ? (user.displayName || (user.email ? user.email.split('@')[0] : 'A Dedicated Father')) : 'A Dedicated Father';
                const completionDate = new Date().toLocaleDateString('en-ZA', { day: 'numeric', month: 'long', year: 'numeric' });

                document.getElementById('cert-user-name').textContent = userName;
                document.getElementById('cert-date').textContent = `on ${completionDate}`;
                
                const certTitle = document.getElementById('cert-title');
                const certLevelName = document.getElementById('cert-level-name');
                const nextModuleBtn = document.getElementById('next-module-btn');

                if(level === 1) {
                    certTitle.textContent = 'Basic Achievement';
                    certLevelName.textContent = 'Module 1: Foundations';
                    nextModuleBtn.classList.remove('hidden');
                    nextModuleBtn.textContent = 'Start Module 2';
                    nextModuleBtn.onclick = () => {
                         certificateModal.classList.remove('active');
                         document.getElementById('quiz1').classList.remove('active');
                         document.getElementById('module2').classList.add('active');
                         unlockModule(2);
                         currentModule = 2;
                         updateProgressBar();
                    };
                }
                // Add logic for level 2 and 3 certificates here
                
                const qrContainer = document.getElementById('cert-qr-code');
                const certificateId = `flamea-cert-const-${level}-${new Date().getTime()}`;
                const verifyUrl = `https://flamea.org/verify?id=${certificateId}`;
                qrContainer.innerHTML = `<img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=${encodeURIComponent(verifyUrl)}" alt="Certificate QR Code"><p class="text-xs text-gray-500 mt-2">Scan to verify ID: ${certificateId}</p>`;
                
                certificateModal.classList.add('active');
            };


            startQuiz1Btn.addEventListener('click', () => showQuiz(1));
            
            quizContainer1.addEventListener('click', selectAnswer);

            submitQuiz1Btn.addEventListener('click', () => {
                const questions = quizContainer1.querySelectorAll('.quiz-question');
                let score = 0;
                questions.forEach(q => {
                    const selected = q.querySelector('.quiz-option.selected');
                    if (selected && selected.dataset.option === q.querySelector('[data-answer]').dataset.answer) {
                        score++;
                    }
                });
                const totalQuestions = questions.length;
                resultsDiv1.innerHTML = `You scored ${score} out of ${totalQuestions}.`;

                if (score === totalQuestions) {
                    resultsDiv1.innerHTML += '<br><span class="text-green-400">Excellent! You have passed the module.</span>';
                    showCertificate(1);
                } else {
                    resultsDiv1.innerHTML += '<br><span class="text-red-400">Please review the content and try again to earn your certificate.</span>';
                }
            });
            
             document.getElementById('close-modal-btn').addEventListener('click', () => {
                certificateModal.classList.remove('active');
            });
            
            document.getElementById('print-cert-btn').addEventListener('click', () => {
                 const { jsPDF } = window.jspdf;
                 const doc = new jsPDF();
                 const certificateContent = document.getElementById('certificate-content');
                 doc.html(certificateContent, {
                     callback: function (doc) {
                         doc.save('FLAMEA_Constitution_Certificate.pdf');
                     },
                     x: 15, y: 15, width: 180, windowWidth: 650
                 });
            });

            // Check auth status to show reminder
            setTimeout(() => { // Use timeout to wait for auth.js to load
                if(window.flamea && window.flamea.auth) {
                    if (!window.flamea.auth.currentUser) {
                        document.getElementById('auth-reminder').classList.remove('hidden');
                    }
                } else {
                    // Fallback if auth module doesn't load
                     document.getElementById('auth-reminder').classList.remove('hidden');
                }
            }, 1500);

            updateProgressBar();
        });
    </script>
    <script type="module" src="../assets/js/auth.js"></script>
</body>
</html>
