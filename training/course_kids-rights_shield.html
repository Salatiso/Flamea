<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Rights, My Shield - A Flamea Kids Course</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Mali:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/style.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <style>
        body { font-family: 'Mali', cursive; }
        .main-container { display: flex; min-height: 100vh; }
        .main-content { 
            flex-grow: 1; 
            overflow-y: auto; 
            background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);
            background-size: cover; 
            background-position: center center;
        }
        .game-title { font-family: 'Fredoka One', cursive; }
        .btn-game { font-family: 'Fredoka One', cursive; transition: all 0.2s ease-in-out; }
        .btn-game:hover { transform: scale(1.05); }

        /* Game Specific Styles */
        .wizard-container {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.5);
        }
        .option-select {
            width: 100%; font-size: 1.1rem; padding: 0.75rem; border-radius: 0.5rem;
            border: 2px solid #60a5fa; background-color: white; color: #1e3a8a; cursor: pointer;
        }
        .feedback-correct { color: #059669; }
        .feedback-incorrect { color: #dc2626; }
        #shield-container { width: 200px; height: 220px; position: relative; }
        .shield-piece {
            position: absolute;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            opacity: 0;
            transform: scale(0.5);
        }
        .shield-piece.visible { opacity: 1; transform: scale(1); }
    </style>
</head>
<body class="bg-gray-900 text-gray-800">
    <div class="main-container">
        <div id="sidebar-placeholder"></div>

        <main class="main-content p-4 md:p-8 flex items-center justify-center">
            
            <!-- Game Hub (Start Screen) -->
            <div id="course-hub" class="max-w-3xl mx-auto text-center">
                <header class="mb-8">
                    <div class="flex justify-center items-center gap-4 mb-4">
                        <!-- SVG Shield Icon -->
                        <svg class="h-20 w-20 text-blue-800" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                           <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/>
                        </svg>
                        <h1 class="game-title text-4xl md:text-5xl text-blue-800">My Rights, My Shield!</h1>
                    </div>
                    <p class="text-lg text-blue-700">Leo the Lion needs your help! His magical Shield of Rights is broken. Answer the questions to put it back together and learn how your rights protect you!</p>
                </header>
                <div class="bg-blue-100/50 backdrop-blur-sm p-6 rounded-2xl border-2 border-white/50">
                    <img src="https://placehold.co/150x150/FBBF24/FFFFFF?text=Leo" alt="Leo the Lion" class="mx-auto rounded-full mb-6 border-4 border-blue-500">
                    <button id="start-btn" class="btn-game bg-green-500 hover:bg-green-600 text-white py-3 px-8 rounded-full text-xl shadow-lg">Let's Go!</button>
                </div>
            </div>

            <!-- Quiz Screen (Initially Hidden) -->
            <div id="quiz-screen" class="wizard-container w-full max-w-4xl mx-auto rounded-2xl shadow-lg p-8 hidden">
                 <!-- Game content will be injected here by JS -->
            </div>
            
            <!-- End Screen (Initially Hidden) -->
            <div id="end-screen" class="wizard-container w-full max-w-2xl mx-auto rounded-2xl shadow-lg p-8 text-center hidden">
                <!-- End screen content will be injected here by JS -->
            </div>
        </main>
    </div>

    <!-- Sidebar Loader Script -->
    <script>
    document.addEventListener('DOMContentLoaded', function () {
        const placeholder = document.getElementById('sidebar-placeholder');
        if(placeholder) {
            fetch('../training-sidebar.html')
                .then(res => res.ok ? res.text() : Promise.reject('Sidebar not found'))
                .then(data => placeholder.outerHTML = data)
                .catch(err => console.error('Sidebar load error:', err));
        }
    });
    </script>
    
    <!-- Game Logic -->
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const courseHub = document.getElementById('course-hub');
        const quizScreen = document.getElementById('quiz-screen');
        const endScreen = document.getElementById('end-screen');
        const startBtn = document.getElementById('start-btn');
        if (!quizScreen || !startBtn) return;

        const courseData = [
            { q: "What is a 'right'?", o: ["A yummy snack", "A special rule that keeps you safe", "A type of toy car"], a: "A special rule that keeps you safe", exp: "That's right! A right is like a promise that helps make sure everyone is treated fairly and kept safe." },
            { q: "Who has rights?", o: ["Only grown-ups", "Only kings and queens", "Every single child"], a: "Every single child", exp: "Exactly! Every child, including you, has special rights just because you are you!" },
            { q: "What is one of your most important rights?", o: ["The right to be safe from harm", "The right to eat candy all day", "The right to never go to bed"], a: "The right to be safe from harm", exp: "You got it! Being safe is a super important right. Grown-ups have a job to help keep you safe." },
            { q: "Every child has the right to a...", o: ["Pony", "Name and a country to belong to", "Spaceship"], a: "Name and a country to belong to", exp: "Yes! Your name is special to you, and you have a right to have one, and to belong to a country." },
            { q: "If you feel unsafe, what should you do?", o: ["Keep it a secret", "Tell a grown-up you trust", "Hide under your bed"], a: "Tell a grown-up you trust", exp: "Perfect! Telling a trusted grown-up like a parent, family member, or teacher is the best way to get help and stay safe." }
        ];

        const shieldPieces = [
            { icon: 'fa-shield-halved', color: 'text-red-500', style: 'top-0 left-1/2 -translate-x-1/2' }, { icon: 'fa-shield-halved', color: 'text-blue-500', style: 'top-1/4 left-0 -rotate-45' }, { icon: 'fa-shield-halved', color: 'text-green-500', style: 'top-1/4 right-0 rotate-45' }, { icon: 'fa-shield-halved', color: 'text-yellow-500', style: 'bottom-0 left-1/4 rotate-45' }, { icon: 'fa-shield-halved', color: 'text-purple-500', style: 'bottom-0 right-1/4 -rotate-45' }
        ];

        let currentQuestionIndex = 0, score = 0, hasAttempted = false;
        const correctSound = new Tone.Synth().toDestination();
        const wrongSound = new Tone.Synth({ oscillator: { type: "square" } }).toDestination();

        function startGame() {
            courseHub.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            endScreen.classList.add('hidden');
            currentQuestionIndex = 0;
            score = 0;
            quizScreen.innerHTML = `
                <div class="flex flex-col md:flex-row items-center gap-8">
                    <div id="shield-container" class="flex-shrink-0"></div>
                    <div class="flex-grow">
                        <h2 id="question-text" class="text-2xl font-bold mb-4"></h2>
                        <select id="answer-options" class="option-select mb-4">
                            <option value="" disabled selected>Choose your answer...</option>
                        </select>
                        <div id="feedback-area" class="min-h-[100px] mt-4"></div>
                    </div>
                </div>
                <div class="flex justify-between mt-4">
                     <button id="back-to-hub" class="btn-game bg-gray-500 text-white py-2 px-4 rounded-full text-sm">Back to Menu</button>
                    <button id="next-btn" class="btn-game bg-blue-500 hover:bg-blue-600 text-white py-2 px-6 rounded-full hidden">Next</button>
                </div>
            `;
            setupShield();
            loadQuestion();
            document.getElementById('next-btn').addEventListener('click', handleNext);
            document.getElementById('answer-options').addEventListener('change', checkAnswer);
            document.getElementById('back-to-hub').addEventListener('click', goBackToHub);
        }

        function setupShield() {
            const shieldContainer = document.getElementById('shield-container');
            shieldContainer.innerHTML = '';
            shieldPieces.forEach((piece, index) => {
                const pieceEl = document.createElement('i');
                pieceEl.className = `fas ${piece.icon} ${piece.color} text-8xl shield-piece`;
                pieceEl.id = `shield-piece-${index}`;
                pieceEl.style.cssText = piece.style;
                shieldContainer.appendChild(pieceEl);
            });
        }

        function loadQuestion() {
            hasAttempted = false;
            document.getElementById('next-btn').classList.add('hidden');
            document.getElementById('feedback-area').innerHTML = '';
            const answerOptionsEl = document.getElementById('answer-options');
            answerOptionsEl.disabled = false;
            
            const questionData = courseData[currentQuestionIndex];
            document.getElementById('question-text').textContent = questionData.q;
            
            answerOptionsEl.innerHTML = '<option value="" disabled selected>Choose your answer...</option>';
            shuffleArray(questionData.o).forEach(option => {
                const optionEl = document.createElement('option');
                optionEl.value = option;
                optionEl.textContent = option;
                answerOptionsEl.appendChild(optionEl);
            });
        }
        
        function checkAnswer() {
            const answerOptionsEl = document.getElementById('answer-options');
            const feedbackAreaEl = document.getElementById('feedback-area');
            const nextBtn = document.getElementById('next-btn');
            const selectedAnswer = answerOptionsEl.value;
            const correctAnswer = courseData[currentQuestionIndex].a;

            answerOptionsEl.disabled = true;

            if (selectedAnswer === correctAnswer) {
                feedbackAreaEl.innerHTML = `<h3 class="text-xl font-bold feedback-correct">Correct! <i class="fas fa-star text-yellow-400"></i></h3><p class="text-gray-600">${courseData[currentQuestionIndex].exp}</p>`;
                if (!hasAttempted) {
                    score += 10;
                    document.getElementById(`shield-piece-${currentQuestionIndex}`).classList.add('visible');
                }
                correctSound.triggerAttackRelease("C5", "8n");
                nextBtn.classList.remove('hidden');
            } else {
                hasAttempted = true;
                feedbackAreaEl.innerHTML = `<h3 class="text-xl font-bold feedback-incorrect">Not quite!</h3><p class="text-gray-600">Try again or see the answer.</p>`;
                wrongSound.triggerAttackRelease("E3", "8n");
                
                const tryAgainBtn = document.createElement('button');
                tryAgainBtn.textContent = 'Try Again';
                tryAgainBtn.className = 'btn-game bg-yellow-500 hover:bg-yellow-600 text-white py-2 px-4 rounded-full text-sm mr-2';
                tryAgainBtn.onclick = () => { answerOptionsEl.disabled = false; feedbackAreaEl.innerHTML = ''; };
                
                const revealBtn = document.createElement('button');
                revealBtn.textContent = 'Show Answer';
                revealBtn.className = 'btn-game bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-full text-sm';
                revealBtn.onclick = () => {
                    feedbackAreaEl.innerHTML = `<p class="text-gray-700">The correct answer is: <strong>${correctAnswer}</strong></p><p class="text-gray-600">${courseData[currentQuestionIndex].exp}</p>`;
                    nextBtn.classList.remove('hidden');
                };
                feedbackAreaEl.appendChild(document.createElement('div')).append(tryAgainBtn, revealBtn);
            }
        }

        function handleNext() {
            currentQuestionIndex++;
            if (currentQuestionIndex < courseData.length) {
                loadQuestion();
            } else {
                showEndScreen();
            }
        }

        function showEndScreen() {
            quizScreen.classList.add('hidden');
            endScreen.classList.remove('hidden');
            const designations = ["Justice Junior", "Constitution Kid"];
            endScreen.innerHTML = `
                <h1 class="game-title text-4xl text-green-600 mb-4">You did it!</h1>
                <p class="mb-4 text-xl">The Shield of Rights is complete! You earned <span class="font-bold">${score}</span> points.</p>
                <p class="text-2xl font-bold text-yellow-500 mb-6">You are a ${designations[Math.floor(Math.random() * 2)]}!</p>
                <img src="https://placehold.co/150x150/FBBF24/FFFFFF?text=Leo" alt="Leo the Lion" class="mx-auto rounded-full mb-6">
                <button id="play-again-btn" class="btn-game bg-green-500 hover:bg-green-600 text-white py-3 px-8 rounded-full text-xl">Play Again</button>
            `;
            document.getElementById('play-again-btn').addEventListener('click', goBackToHub);
        }

        function goBackToHub() {
            endScreen.classList.add('hidden');
            quizScreen.classList.add('hidden');
            courseHub.classList.remove('hidden');
        }
        
        function shuffleArray(array) {
            return [...array].sort(() => Math.random() - 0.5);
        }

        startBtn.addEventListener('click', startGame);
    });
    </script>
</body>
</html>
