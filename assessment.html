<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iSazisi sikaTata - The Father's Compass - Flamea</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@700&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.min.css">
    <style>
        /* This ensures the main container layout is correct, allowing the background to show */
        .main-container { display: flex; min-height: 100vh; }
        .main-content { flex-grow: 1; overflow-y: auto; }
        .wizard-step {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        .wizard-step.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .option-button {
            transition: all 0.2s ease-in-out;
        }
        .option-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 255, 150, 0.1);
        }
        .option-button.selected {
            background-color: #16a34a; /* green-600 */
            border-color: #16a34a;
            color: white;
            box-shadow: 0 0 20px rgba(22, 163, 74, 0.5);
        }
        #progress-bar-inner {
            transition: width 0.5s ease-in-out;
        }
        .recommendation-card:hover {
            border-color: #4ade80;
            background-color: #1f2937;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">
    <div class="main-container">
        <div id="sidebar-placeholder"></div>

        <main class="main-content flex-grow p-4 sm:p-8 md:p-12">
            <div class="max-w-4xl mx-auto">

                <div class="text-box bg-gray-800 p-6 rounded-lg shadow-md text-center mb-12">
                    <h1 class="text-4xl md:text-5xl font-bold text-white font-roboto-slab">iSazisi sikaTata</h1>
                    <p class="text-lg md:text-xl text-green-400 mt-2">The Father's Compass</p>
                </div>

                <div id="assessment-container" class="bg-gray-800 p-6 sm:p-10 rounded-2xl shadow-2xl border border-gray-700">
                    
                    <div id="start-screen" class="wizard-step active text-center">
                        <h2 class="text-3xl font-bold mb-4 text-white">Discover Your Path.</h2>
                        <p class="text-gray-400 mb-6 max-w-2xl mx-auto">This tool will help you understand your situation and empower you with the right resources. Select the issue that best describes what's on your mind, and let's begin.</p>
                        <div class="mb-8">
                            <label for="initial-issue" class="form-label text-left font-semibold text-gray-300">What is the main issue you're facing?</label>
                            <select id="initial-issue" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-300 text-white">
                                <option value="" disabled selected>Select the issue that best describes yours...</option>
                                <option value="Access">Access to my child is being denied or limited.</option>
                                <option value="Finance">We disagree on financial contributions for the child.</option>
                                <option value="Plan">I need to create a formal, legally sound Parenting Plan.</option>
                                <option value="Legal">I am dealing with a difficult legal system or unfair treatment.</option>
                                <option value="Rights">I want to understand my Constitutional rights as a father.</option>
                                <option value="Learn">I just want to learn more and become a better, more involved father.</option>
                            </select>
                        </div>
                        <button id="start-assessment-btn" class="bg-green-600 text-white font-bold py-3 px-10 rounded-lg hover:bg-green-700 transition-colors text-lg">
                            Start the Compass <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>

                    <div id="question-screen" class="wizard-step">
                        <div class="flex justify-between items-start mb-6">
                             <div>
                                <h3 id="question-title" class="text-2xl font-bold text-white"></h3>
                                <p id="question-text" class="text-gray-300 mt-1"></p>
                            </div>
                            <span id="question-counter" class="text-sm font-semibold bg-gray-700 text-green-400 px-3 py-1 rounded-full flex-shrink-0"></span>
                        </div>
                       
                        <div id="progress-bar" class="w-full bg-gray-700 rounded-full h-2.5 mb-8">
                            <div id="progress-bar-inner" class="bg-green-500 h-2.5 rounded-full" style="width: 0%"></div>
                        </div>

                        <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                    </div>

                    <div id="results-screen" class="wizard-step text-center">
                        <h2 class="text-3xl font-bold mb-4 text-green-400">Your Compass Reading is Complete</h2>
                        <div id="results-summary" class="mb-8 text-gray-300"></div>
                        <div id="recommendations-container" class="space-y-4 text-left"></div>
                        <div class="mt-8 flex justify-center gap-4">
                            <button id="restart-assessment-btn" class="bg-gray-600 py-2 px-6 rounded-lg hover:bg-gray-500 font-semibold text-white">Start Over</button>
                            <a href="login.html" class="bg-green-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-green-700 transition-colors">Save Results</a>
                        </div>
                    </div>

                    <div id="navigation-controls" class="mt-10 pt-6 border-t border-gray-700 flex justify-between items-center" style="display: none;">
                        <button id="back-btn" class="bg-gray-600 py-2 px-6 rounded-lg hover:bg-gray-500 font-semibold text-white">Back</button>
                        <button id="next-btn" class="bg-green-600 py-2 px-6 rounded-lg hover:bg-green-700 font-semibold text-white">Next</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
    // --- SELF-CONTAINED ASSESSMENT LOGIC ---
    document.addEventListener('DOMContentLoaded', () => {

        // --- 1. SIDEBAR LOADER (FIXED) ---
        const placeholder = document.getElementById('sidebar-placeholder');
        if(placeholder) {
            // The path 'sidebar.html' is relative to the root, which is correct for this page.
            fetch('sidebar.html')
                .then(response => {
                    if (!response.ok) throw new Error(`Sidebar not found at path: sidebar.html`);
                    return response.text();
                })
                .then(data => {
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = data;
                    const sidebarElement = tempDiv.querySelector('aside');
                    if(sidebarElement) {
                       placeholder.replaceWith(sidebarElement);
                    } else {
                       throw new Error("Could not find the <aside> element in the fetched sidebar.html.");
                    }
                }).catch(error => {
                    console.error('Error loading sidebar:', error);
                    placeholder.innerHTML = `<div class="p-4 text-red-500 bg-gray-800">Sidebar could not be loaded.</div>`;
                });
        }

        // --- 2. ASSESSMENT TOOL LOGIC (PRESERVED) ---
        const startScreen = document.getElementById('start-screen');
        const questionScreen = document.getElementById('question-screen');
        const resultsScreen = document.getElementById('results-screen');
        const navigationControls = document.getElementById('navigation-controls');
        
        const startBtn = document.getElementById('start-assessment-btn');
        const nextBtn = document.getElementById('next-btn');
        const backBtn = document.getElementById('back-btn');
        const restartBtn = document.getElementById('restart-assessment-btn');

        let currentQuestionIndex = 0;
        let userAnswers = {};
        let questionFlow = [];

        const questionDatabase = {
            'Access': [
                { id: 'contact_status', text: 'What is the current status of your contact with your child?', options: ['No contact at all', 'Limited/supervised contact', 'Regular contact, but inconsistent'], tags: ['access', 'conflict'] },
                { id: 'agreement_exists', text: 'Is there any existing verbal or written agreement about contact?', options: ['No agreement', 'Verbal agreement (not followed)', 'Written plan (not followed)', 'We have a working plan'], tags: ['agreement', 'plan'] },
                { id: 'communication', text: 'How is communication with the other parent?', options: ['Hostile or blocked', 'Difficult but possible', 'Amicable'], tags: ['communication', 'conflict'] }
            ],
            'Finance': [
                { id: 'finance_agreement', text: 'Is there a formal agreement on financial contributions?', options: ['No agreement', 'Verbal agreement', 'Court order/written plan'], tags: ['finance', 'agreement'] },
                { id: 'contribution_dispute', text: 'What is the nature of the disagreement?', options: ['Amount of maintenance', 'What expenses are covered', 'Unwillingness to pay'], tags: ['finance', 'dispute'] },
            ],
            'Plan': [
                { id: 'plan_reason', text: 'Why do you need to create a parenting plan?', options: ['To prevent future conflict', 'To resolve current conflict', 'To formalize our agreement for legal purposes'], tags: ['plan', 'agreement', 'conflict'] },
                { id: 'knowledge_level', text: "How familiar are you with the Children's Act?", options: ['Not familiar', 'I know the basics', 'Well-informed'], tags: ['legal', 'rights'] }
            ],
            'Legal': [
                { id: 'legal_issue', text: 'What part of the legal system are you struggling with?', options: ['Court proceedings', 'Police (SAPS) inaction', 'Unfair treatment by officials'], tags: ['legal', 'saps', 'court'] },
                { id: 'have_represenation', text: 'Do you have legal representation?', options: ['Yes, a private lawyer', 'Yes, Legal Aid', 'No, I am representing myself'], tags: ['legal_aid', 'representation'] }
            ],
            'Rights': [
                { id: 'rights_situation', text: 'In what area do you feel your rights are not being respected?', options: ['Access to my child', 'Making decisions about their life', 'Being recognized as a legal parent'], tags: ['rights', 'access', 'decision'] }
            ],
            'Learn': [
                { id: 'learn_focus', text: 'What area are you most interested in learning about?', options: ['My legal rights and responsibilities', 'Practical co-parenting skills', 'Connecting with my child better'], tags: ['learn', 'rights', 'parenting'] }
            ]
        };

        const resourceDatabase = {
            'constitution_training': { title: 'The Constitution Course', description: 'The ultimate shield. Understand your supreme rights as a father.', link: 'training/course-constitution.html', icon: 'fa-shield-alt', tags: ['rights', 'legal', 'learn', 'access', 'plan', 'finance', 'conflict'] },
            'parenting_plan_template': { title: 'Parenting Plan Template', description: 'A comprehensive, editable form to build a solid co-parenting agreement.', link: 'assets/templates/Parenting_Plan_Template.html', icon: 'fa-file-alt', tags: ['plan', 'agreement', 'access', 'finance', 'communication'] },
            'affirmation_letter': { title: 'Affirmation of Rights Letter', description: 'A formal letter to assert your parental rights and request co-operation.', link: 'assets/templates/Affirmation_Parental_Rights_and_Responsibilities_final.html', icon: 'fa-fist-raised', tags: ['access', 'rights', 'conflict', 'communication'] },
            'saps_complaint': { title: 'SAPS Complaint Affidavit', description: 'Use this to formally lodge a complaint if SAPS is not assisting you.', link: 'assets/templates/Affidavit-SAPS_Complaint_.html', icon: 'fa-exclamation-triangle', tags: ['saps', 'legal'] },
            'coparenting_training': { title: 'Effective Co-Parenting Course', description: 'Learn strategies for better communication and conflict resolution.', link: 'training/course-coparenting.html', icon: 'fa-users', tags: ['communication', 'conflict', 'parenting', 'learn'] },
            'childrens_act_training': { title: "Children's Act Course", description: 'Understand the key law governing your rights and responsibilities.', link: 'training/course-childrens-act.html', icon: 'fa-gavel', tags: ['legal', 'rights', 'plan'] },
        };

        function startAssessment() {
            const initialIssue = document.getElementById('initial-issue').value;
            if (!initialIssue) { alert("Please select your main issue to begin."); return; }
            userAnswers = { initialIssue };
            questionFlow = questionDatabase[initialIssue] || [];
            currentQuestionIndex = 0;
            startScreen.classList.remove('active');
            resultsScreen.classList.remove('active');
            questionScreen.classList.add('active');
            navigationControls.style.display = 'flex';
            displayQuestion();
        }

        function displayQuestion() {
            const question = questionFlow[currentQuestionIndex];
            document.getElementById('question-title').textContent = `Step ${currentQuestionIndex + 1}`;
            document.getElementById('question-text').textContent = question.text;
            document.getElementById('question-counter').textContent = `${currentQuestionIndex + 1} / ${questionFlow.length}`;
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            question.options.forEach(optionText => {
                const button = document.createElement('button');
                button.className = 'option-button w-full text-left p-4 bg-gray-700 border-2 border-gray-600 rounded-lg hover:border-green-500';
                button.textContent = optionText;
                button.dataset.answer = optionText;
                if (userAnswers[question.id] === optionText) { button.classList.add('selected'); }
                button.onclick = () => {
                    userAnswers[question.id] = optionText;
                    userAnswers.tags = [...(userAnswers.tags || []), ...question.tags];
                    document.querySelectorAll('.option-button').forEach(btn => btn.classList.remove('selected'));
                    button.classList.add('selected');
                    nextBtn.disabled = false;
                };
                optionsContainer.appendChild(button);
            });
            nextBtn.disabled = !userAnswers[question.id];
            backBtn.style.visibility = currentQuestionIndex === 0 ? 'hidden' : 'visible';
            const progress = ((currentQuestionIndex + 1) / questionFlow.length) * 100;
            document.getElementById('progress-bar-inner').style.width = `${progress}%`;
        }
        
        function nextQuestion() {
            if (currentQuestionIndex < questionFlow.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                showResults();
            }
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function showResults() {
            questionScreen.classList.remove('active');
            navigationControls.style.display = 'none';
            resultsScreen.classList.add('active');
            const summary = document.getElementById('results-summary');
            const recommendationsContainer = document.getElementById('recommendations-container');
            summary.innerHTML = `<p>Based on your answers, here are some recommended resources to start with:</p>`;
            recommendationsContainer.innerHTML = '';
            const recommendedKeys = new Set(['constitution_training']);
            const answerTags = new Set(userAnswers.tags || []);
            const initialQuestion = questionDatabase[userAnswers.initialIssue];
            if(initialQuestion) initialQuestion.forEach(q => q.tags.forEach(t => answerTags.add(t)));
            Object.entries(resourceDatabase).forEach(([key, resource]) => {
                if (resource.tags.some(tag => answerTags.has(tag))) {
                    recommendedKeys.add(key);
                }
            });
            recommendedKeys.forEach(key => {
                const resource = resourceDatabase[key];
                const card = document.createElement('a');
                card.href = resource.link;
                card.target = "_blank";
                card.className = "recommendation-card block bg-gray-700 p-4 rounded-lg border-2 border-transparent hover:border-green-400 transition-all duration-300 flex items-start gap-4";
                card.innerHTML = `
                    <i class="fas ${resource.icon} text-2xl text-green-400 mt-1 w-8 text-center"></i>
                    <div>
                        <h4 class="font-bold text-lg text-white">${resource.title}</h4>
                        <p class="text-gray-400 text-sm">${resource.description}</p>
                    </div>`;
                recommendationsContainer.appendChild(card);
            });
        }

        function restartAssessment() {
            currentQuestionIndex = 0;
            userAnswers = {};
            questionFlow = [];
            resultsScreen.classList.remove('active');
            startScreen.classList.add('active');
        }

        startBtn.addEventListener('click', startAssessment);
        nextBtn.addEventListener('click', nextQuestion);
        backBtn.addEventListener('click', prevQuestion);
        restartBtn.addEventListener('click', restartAssessment);
    });
    </script>
</body>
</html>
